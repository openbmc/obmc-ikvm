{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "0ebb6d1f_2a90ab09",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 31,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2024-06-04T00:43:37Z",
      "side": 1,
      "message": "As written I don\u0027t follow the sequence that leads to the problem; I don\u0027t see anywhere that serverThread calls `setVideoDone()`.  Is `setVideoDone` in this line supposed to be `waitVideo` instead?",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44e50708_eb0cf93d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 31,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T10:11:10Z",
      "side": 1,
      "message": "Yes, the line is \u0027waitVideo\u0027.",
      "parentUuid": "0ebb6d1f_2a90ab09",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b7c0085_01e8fd8d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 31,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T10:41:40Z",
      "side": 1,
      "message": "The mainThread executes the function \u0027waitServer\u0027 before it sets \u0027videoDone\u0027 to be false, then mainThread is blocked until that serverThread set serverDone to be true. Nextly, the cpu switches to serverThread that execute the function \u0027waitVideo\u0027. Because the videoDone is true, serverThread is able to execute continuously seting serverDone to be true. Finally the mainThread will be unblocked.",
      "parentUuid": "44e50708_eb0cf93d",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "eb4bc859_d475d1da",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 31,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T12:06:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1b7c0085_01e8fd8d",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4b91e6d_0c6512a4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 38,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2024-06-04T00:43:37Z",
      "side": 1,
      "message": "Nit: `s/videon done/videoDone/`",
      "range": {
        "startLine": 38,
        "startChar": 7,
        "endLine": 38,
        "endChar": 18
      },
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "deadc23a_51910347",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 38,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T10:11:10Z",
      "side": 1,
      "message": "Thank you for pointing it out. Revised as your suggestion.",
      "parentUuid": "e4b91e6d_0c6512a4",
      "range": {
        "startLine": 38,
        "startChar": 7,
        "endLine": 38,
        "endChar": 18
      },
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3d6fa77_95184ee7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 39,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2024-06-04T00:43:37Z",
      "side": 1,
      "message": "Aside from the small confusion noted above, the description of the problem is very good -- thanks for writing it up so thoroughly.  However, it would be good to also include at least a brief description of why/how the change in the patch solves the problem.",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "08d47f2d_f15eae69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 39,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T12:06:06Z",
      "side": 1,
      "message": "The mainThread sets videoDone to false before it executes the function waitServer, then the CPU blocks the mainThread and swithes to execute serverThread. While the serverThread is blocked for waiting videoDone to be set to true. In the case creates a deadlock.\n\nThe patch delays to set videoDone to false after the mainThread is blocked for waiting serverDone, then the value of the videoDone maintains true. So the serverThread is unblocked as the videDone is true. After the serverThread finishes executing the function setServerDone, The CPU will unblocks mainThread.",
      "parentUuid": "f3d6fa77_95184ee7",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7df3d8d7_3528651a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 39,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-04T12:06:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "08d47f2d_f15eae69",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79255ea2_cb7765e5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 39,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2024-06-04T18:07:54Z",
      "side": 1,
      "message": "Thanks, that\u0027s the sort of explanation I was looking for, though I meant to add it to the commit message so it ends up included in the actual repository where people can see it more easily, not just on a gerrit review.\n\nAnd as a small nitpick on the wording of the explanation, I think the last sentence would be slightly more accurate as something like:\n\n\u003e After serverThread finishes executing setServerDone, mainThread is unblocked and continues executing.\n\n(Because it isn\u0027t really the CPU itself that blocks and unblocks threads, it\u0027s the OS kernel, and then generally only as a result of actions taken by userspace threads, such as the `sync.notify_all()` call in this case.)",
      "parentUuid": "7df3d8d7_3528651a",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6be4ece2_7d750866",
        "filename": "/COMMIT_MSG",
        "patchSetId": 8
      },
      "lineNbr": 39,
      "author": {
        "id": 1001000
      },
      "writtenOn": "2024-06-05T07:45:35Z",
      "side": 1,
      "message": "Got it. The gerrit review was appended to the commit message. Thanks a lot for the trouble you\u0027ve taken to understand and polish my comments. Forgive me for my poor English ^_^.",
      "parentUuid": "79255ea2_cb7765e5",
      "revId": "779060a4f8652bd8c291900f4853b25a4b264564",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}